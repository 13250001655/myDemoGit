<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>消息列表</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <style>
        body {
            background: #fff;
            height: auto;
        }

        .eye-icon {
            top: 12px;
        }
    </style>
</head>

<body>
    <ul id="passwordlist" class="passwordlist">
        <li><i class="psw-icon"></i><input type="password" name="oldpassword" id="oldpassword" class="input" placeholder="请输入原来密码"><i class="eye-icon" tapmode onclick="changePswStatus(this);"></i></li>
        <li><i class="psw-icon"></i><input type="password" name="password" id="password" class="input" placeholder="请输入新密码"><i class="eye-icon" tapmode onclick="changePswStatus(this);"></i></li>
        <li><i class="psw-icon"></i><input type="password" name="repassword" id="repassword" class="input" placeholder="请再次输入新密码"><i class="eye-icon" tapmode onclick="changePswStatus(this);"></i></li>
    </ul>
    <div class="accountbtn"><input type="button" id="dobtn" tapmode onclick="editPassword()" value="提交"></div>
    <script type="text/javascript" src="../script/api.js"></script>
    <script>
        apiready = function() {

        }

        function editPassword() {
            var oldpassword = $api.byId("oldpassword").value;
            var password = $api.byId("password").value;
            var repassword = $api.byId("repassword").value;

            if (oldpassword.length == 0) {
                api.toast({
                    msg: '请输入旧的密码',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            if (password.length == 0) {
                api.toast({
                    msg: '请输入新的密码',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            if (password.length < 6 || password.length > 20) {
                api.toast({
                    msg: '密码长度在6-20个字符之间',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            if (repassword != password) {
                api.toast({
                    msg: '两次新密码输入不一致',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            api.showProgress();

            api.ajax({
                url: myurl + '/index.php/User/Public/password/',
                method: 'post',
                data: {
                    values: {
                        username: $api.getStorage("username"),
                        userid: $api.getStorage("userid"),
                        oldpassword: oldpassword,
                        password: password
                    }
                }
            }, function(ret, err) {
                api.hideProgress();

                if (ret) {
                    api.toast({
                        msg: ret.msg,
                        duration: 1000,
                        location: 'bottom'
                    });

                    if (ret.status == 1) {
                        setTimeout(function() {
                            api.closeWin();
                        }, 1000);

                    }
                } else {
                    // alert(JSON.stringify(err))
                    api.toast({
                        msg: '网络错误',
                        duration: 2000,
                        location: 'bottom'
                    });

                }
            });

        }
    </script>
</body>

</html>
