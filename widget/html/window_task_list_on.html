<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>未完成</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <style>
        .task-nav {
            margin-top: 6px;
            background-color: #fff;
            margin-bottom: 10px;
        }

        .task-nav .nav-controll {
            float: left;
            text-align: center;
            height: 42px;
            line-height: 42px;
            width: 20%;
            cursor: pointer;
            position: relative;
        }

        .task-nav .nav-controll.active {
            color: #04b848;
        }

        .task-nav .nav-controll>p {
            position: absolute;
            top: 2px;
            right: 50%;
            margin-right: -45px;
            width: 24px;
            height: 24px;
            line-height: 24px;
            color: #fff;
            border-radius: 50%;
            background-color: #f00;
            display: none;
        }

        .task-nav .nav-controll:last-child>p {
            margin-right: -37px;
        }
    </style>
</head>

<body>
    <div id="header"></div>
    <header class="head2">
        <a class="left" tapmode onclick="closeTaskList();"><span>&#xe606;</span>未完成订单</a>
    </header>
    <div class="task-nav clearfix">
        <div class="nav-controll active" onclick="openFrame(0);">待操作
            <p id="dcz"></p>
        </div>
        <div class="nav-controll" onclick="openFrame(1);">待返款
            <p id="dsh"></p>
        </div>
        <div class="nav-controll" onclick="openFrame(2);">待评价
            <p id="dhp"></p>
        </div>
        <div class="nav-controll" onclick="openFrame(3);">待追评
            <p id="dzp"></p>
        </div>
        <div class="nav-controll" onclick="openFrame(4);">全部
            <p id="all"></p>
        </div>
    </div>
    <div class="task_list">
    </div>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
    apiready = function() {
        var header = document.querySelector('#header');
        $api.fixStatusBar(header);
        // NVNavigationBar_open();
        // openFrame();
        if (api.pageParam.task_progress == 1) {
            openFrame(1);
        } else {
            openFrame(0);
        }
        getTaskNum();
    };

    function closeTaskList() {
        var jsfun_order = 'getOrderNum()';
        api.execScript({
            name: 'window_task',
            frameName: 'frame_task',
            script: jsfun_order
        });

        api.closeWin();
    }

    function openFrame(index) {
        var domAll = $api.domAll('.nav-controll');
        for (var i = 0; i < domAll.length; i++) {
            if ($api.hasCls(domAll[i], 'active')) {
                $api.removeCls(domAll[i], 'active');
            }
        }
        $api.addCls(domAll[index], 'active');

        var h = $api.offset(document.querySelector('#header')).h;
        api.openFrame({
            name: 'frame_task_item_' + index,
            url: './frame_task_item_' + index + '.html',
            rect: {
                x: 0,
                y: 92 + h,
                w: 'auto',
                h: 'auto'
            },
            pageParam: {
                name: 'frame_task_item_' + index,
                pt_id: api.pageParam.pt_id
            },
            bounces: false,
            reload: true,
            bgColor: 'rgba(0,0,0,0)',
            vScrollBarEnabled: true,
            hScrollBarEnabled: true
        });
        getTaskNum();
    }

    function getTaskNum() {
        api.showProgress();
        api.ajax({
            url: myurl + '/index.php/User/Task/getPlatformAllOrderNum',
            method: 'post',
            data: {
                values: {
                    username: $api.getStorage("username"),
                    userid: $api.getStorage("userid"),
                    platform_id: api.pageParam.pt_id
                }
            }
        }, function(ret, err) {
            api.hideProgress();
            if (ret) {
                if (ret.status == 1) {
                    // dcz 待操作
                    // dsh 待返款
                    // dhp 待评价
                    // dzp 待追评
                    // all 全部
                    var data = ret.data;

                    // 待操作
                    var dcz = data.dcz;
                    if (dcz > 999) {
                        dcz = '999';
                    }
                    $api.html($api.byId('dcz'), dcz);
                    if (dcz == 0) {
                        $api.css($api.byId('dcz'), 'display: none');
                    } else {
                        $api.css($api.byId('dcz'), 'display: block');
                    }

                    // 待返款
                    var dsh = data.dsh;
                    if (dsh > 999) {
                        dsh = '999';
                    }
                    $api.html($api.byId('dsh'), dsh);
                    if (dsh == 0) {
                        $api.css($api.byId('dsh'), 'display: none');
                    } else {
                        $api.css($api.byId('dsh'), 'display: block');
                    }

                    // 待评价
                    var dhp = data.dhp;
                    if (dhp > 999) {
                        dhp = '999';
                    }
                    $api.html($api.byId('dhp'), dhp);
                    if (dhp == 0) {
                        $api.css($api.byId('dhp'), 'display: none');
                    } else {
                        $api.css($api.byId('dhp'), 'display: block');
                    }

                    // 待追评
                    var dzp = data.dzp;
                    if (dzp > 999) {
                        dzp = '999';
                    }
                    $api.html($api.byId('dzp'), dzp);
                    if (dzp == 0) {
                        $api.css($api.byId('dzp'), 'display: none');
                    } else {
                        $api.css($api.byId('dzp'), 'display: block');
                    }

                    // 全部
                    var all = data.all;
                    if (all > 999) {
                        all = '999';
                    }
                    $api.html($api.byId('all'), all);
                    if (all == 0) {
                        $api.css($api.byId('all'), 'display: none');
                    } else {
                        $api.css($api.byId('all'), 'display: block');
                    }
                }
            } else {
                api.toast({
                    msg: '网络错误',
                    duration: 2000,
                    location: 'bottom'
                });
            }
        });
    }

    // function NVNavigationBar_open() {
    //     var header = document.querySelector('#header');
    //     $api.fixStatusBar(header);
    //     var h = $api.offset(document.querySelector('#header')).h;
    //     // fnsetFrameGroupIndex('task_on_group', 0);
    //     var navigationBar = api.require('NVNavigationBar');
    //     navigationBar.open({
    //         rect: {
    //             x: 0,
    //             y: 50 + h,
    //             w: api.frameWidth,
    //             h: 42,
    //         },
    //         styles: {
    //             orientation: 'horizontal',
    //             bg: '',
    //             bgAlpha: 1,
    //             font: {
    //                 size: 14,
    //                 sizeSelected: 14,
    //                 color: '#333333',
    //                 colorSelected: '#04b848',
    //                 alpha: 1
    //             },
    //             itemSize: {
    //                 w: api.winWidth / 5,
    //             }
    //         },
    //         items: [{
    //             title: '待操作',
    //             bg: '#ffffff',
    //         }, {
    //             title: '待返款',
    //             bg: '#ffffff',
    //         }, {
    //             title: '待评价',
    //             bg: '#ffffff',
    //         }, {
    //             title: '待追评',
    //             bg: '#ffffff',
    //         }, {
    //             title: '全部',
    //             bg: '#ffffff',
    //         }],
    //         fixedOn: api.frameName,
    //         id: 'task_on_group',
    //         selectedIndex: 0
    //     }, function(ret, err) {
    //         if (ret) {
    //             if (ret.eventType == 'click') {
    //                 fnsetFrameGroupIndex('task_on_group', ret.index);
    //             }
    //         } else {}
    //     });
    // }
    //
    // function openFrame() {
    //     var h = $api.offset(document.querySelector('#header')).h;
    //     api.openFrameGroup({
    //         name: 'task_on_group',
    //         rect: {
    //             x: 0,
    //             y: 92 + h,
    //             w: "auto",
    //             h: api.frameHeight - 92 - h
    //         },
    //         index: 0,
    //         scrollEnabled: true,
    //         preload: 3,
    //         frames: [{
    //             name: 'frame_task_item_0',
    //             url: 'frame_task_item_0.html',
    //             pageParam: {
    //                 name: 'frame_task_item_0',
    //                 pt_id: api.pageParam.pt_id
    //             },
    //             // bounces: false,
    //             // customRefreshHeader: 'UIPullRefresh'
    //         }, {
    //             name: 'frame_task_item_1',
    //             url: 'frame_task_item_1.html',
    //             pageParam: {
    //                 name: 'frame_task_item_1',
    //                 pt_id: api.pageParam.pt_id
    //             },
    //             // bounces: false,
    //             // customRefreshHeader: 'UIPullRefresh'
    //         }, {
    //             name: 'frame_task_item_2',
    //             url: 'frame_task_item_2.html',
    //             pageParam: {
    //                 name: 'frame_task_item_2',
    //                 pt_id: api.pageParam.pt_id
    //             },
    //             // bounces: false,
    //             // customRefreshHeader: 'UIPullRefresh'
    //         }, {
    //             name: 'frame_task_item_3',
    //             url: 'frame_task_item_3.html',
    //             pageParam: {
    //                 name: 'frame_task_item_3',
    //                 pt_id: api.pageParam.pt_id
    //             },
    //             // bounces: false,
    //             // customRefreshHeader: 'UIPullRefresh'
    //         }, {
    //             name: 'frame_task_item_4',
    //             url: 'frame_task_item_4.html',
    //             pageParam: {
    //                 name: 'frame_task_item_4',
    //                 pt_id: api.pageParam.pt_id
    //             },
    //             // bounces: false,
    //             // customRefreshHeader: 'UIPullRefresh'
    //         }]
    //     }, function(ret, err) {
    //         if (ret) {
    //             if (ret.index > -1) {
    //                 fnNvnsetSelected(ret.index);
    //             }
    //         } else {
    //             alert(JSON.stringify(err));
    //         }
    //     });
    // }
    //
    // function fnNvnsetSelected(index) {
    //     var NVNavigationBar = api.require('NVNavigationBar');
    //     NVNavigationBar.setSelected({
    //         id: 'task_on_group',
    //         index: index,
    //         selected: true
    //     }, function(ret) {
    //
    //     });
    // }
    //
    // function fnsetFrameGroupIndex(name, index) {
    //     api.setFrameGroupIndex({
    //         name: name,
    //         index: index,
    //         scroll: true
    //     });
    // }
</script>
