<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>公告列表</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <style>
        .see-require {
            width: 100%;
            font-size: 18px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            color: #f00;
            background-color: #a8e063;
        }
    </style>
</head>

<body>
    <div class="bankinfo1">
        <div class="tit"><span>&#xe615;</span>注意事项</div>
        <div class="con">
            账号审核时间周一至周五<span>9:00 - 18:00</span>，账号提交后5个工作日内完成审核，如遇周末或节假日顺延，审核工作人工进行，用户请耐心等待！
        </div>
    </div>

    <form id="dataForm">
        <div class="taobaobox" style="margin-top: 0;">
            <div class="tit">账号信息</div>
            <div class="con">
                <ul>
                    <li><span class="iname">请输入拼多多昵称</span>
                        <div><input type="text" name="accname" id="accname" placeholder="请输入"></div>
                    </li>
                    <li><span class="iname">收货人姓名</span>
                        <div><input type="text" name="nickname" id="nickname" placeholder="请输入"></div>
                    </li>
                    <li><span class="iname">收货人手机</span>
                        <div><input type="text" name="phone" id="phone" placeholder="请输入"></div>
                    </li>
                    <li><span class="iname">请输入验证码</span>
                        <div class="div1" style="padding-right: 70px;"><input type="text" name="vcode" id="vcode" value="" placeholder="请输入"></div><a id="get_code" tapmode onclick="getCode()" class="get_code">获取验证码</a>
                    </li>
                    <li><span class="iname">请输入所在省市县/区</span>
                        <!-- <div class="div1"><input type="text" name="city" readonly id="city" tapmode onclick="openCity()" value=""></div><span class="arrow" tapmode onclick="openCity()">&#xe603;</span> -->
                        <div class="div1"><input type="text" name="city" id="city" value="" placeholder="请输入"></div>
                    </li>
                    <li><span class="iname">请输入详细地址</span>
                        <div><input type="text" name="address" id="address" value="" placeholder="请输入"></div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="taobaobox">
            <div class="tit">账号属性(与实名认证的省份信息一致)</div>
            <div class="con">
                <ul>
                    <li><span class="iname">性别</span>
                        <div>
                            <select id="sex" name="sex" dir="rtl">
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select></div>
                    </li>
                    <li><span class="iname">年龄</span>
                        <div><input type="number" name="age" id="age" value="" placeholder="请输入"></div>
                    </li>
                    <li><span class="iname">订单号</span>
                        <div><input type="text" name="order_number" id="order_number" value="" placeholder="请输入最新一笔拼多多订单号"></div>
                    </li>
                    <li style="padding-bottom: 10px;">
                        <p style="color: #e31818;">乱填写、填写错误都会导致无法做任务</p>
                        <div class="seeEOS-container clearfix" style="padding-left: 0;">
                            <p style="width: 80px; float: left;">点击上传图片</p>
                            <p style="width: 60px; float: right; text-align: right; color: #04b848;" class="seeEOS" tapmode onclick="seeEOS(3);">查看图例</p>
                        </div>
                        <div class="pic" tapmode onclick="showAction('上传个人资料','grzl_img')"><img id="grzl_img" src="../image/file-img.png" />
                            <p>个人资料</p>
                        </div>
                        <input type="hidden" name="grzl_img" id="input_grzl_img">

                        <div class="pic" tapmode onclick="showAction('上传订单截图','ddjt_img')"><img id="ddjt_img" src="../image/file-img.png" />
                            <p>订单截图</p>
                        </div>
                        <input type="hidden" name="ddjt_img" id="input_ddjt_img">

                    </li>
                </ul>
            </div>
        </div>
        <div class="see-require" tapmode onclick="seeEOS(3);">进入查看绑定要求</div>
        <p class="lostTips" style="display: none; color: #f00; text-align: center; padding-top: 15px;"></p>
        <div class="accountbtn"><input type="button" id="dobtn" tapmode onclick="postPdd()" value="提交" /></div>
        <input type="hidden" name="id" id="id" value="0" />
    </form>
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/jquery.min.js"></script>
    <script>
        apiready = function() {
            getAccount();
        }

        function getAccount() {
            api.showProgress();
            api.ajax({
                url: myurl + '/index.php/User/Api/getaccount/',
                method: 'post',
                data: {
                    values: {
                        username: $api.getStorage("username"),
                        userid: $api.getStorage("userid"),
                        platform_id: 3
                    }
                }
            }, function(ret, err) {
                api.hideProgress();
                if (ret.status == 1) {
                    var data = ret.data;
                    if (data) {
                        $("#id").val(data["id"]);
                        $("#accname").val(data["accname"]);
                        $("#nickname").val(data["nickname"]);
                        $("#phone").val(data["phone"]);
                        $("#city").val(data["city"]);
                        $("#address").val(data["address"]);

                        $("#sex").val(data["sex"]);
                        $("#age").val(data["age"]);
                        $("#order_number").val(data["order_number"]);


                        if (!isempty(data["grzl_img"])) {
                            $("#grzl_img").attr("src", data["grzl_img"]);
                            $("#input_grzl_img").val(data["grzl_img"]);
                        }

                        if (!isempty(data["ddjt_img"])) {
                            $("#ddjt_img").attr("src", data["ddjt_img"]);
                            $("#input_ddjt_img").val(data["ddjt_img"]);
                        }

                        if (data["status"] == -1) {
                            $api.html($api.dom('.lostTips'), data['content']);
                            $api.css($api.dom('.lostTips'), 'display: block');
                        } else {
                            $api.html($api.dom('.lostTips'), '');
                            $api.css($api.dom('.lostTips'), 'display: none');
                        }
                    }
                }
            });

        }

        //拼多多账号
        function postPdd() {
            if ($("#accname").val() == "") {
                api.toast({
                    msg: '请输入拼多多昵称',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            if ($("#nickname").val() == "") {
                api.toast({
                    msg: '请输入收货人姓名',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            if ($("#phone").val() == "") {
                api.toast({
                    msg: '请输入收货人手机',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            if ($("#vcode").val() == "") {
                api.toast({
                    msg: '请输入验证码',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }

            if ($("#city").val() == "") {
                api.toast({
                    msg: '请输入所在省市县/区',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }

            if ($("#address").val() == "") {
                api.toast({
                    msg: '请输入详细地址',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }

            if ($("#sex").val() == "") {
                api.toast({
                    msg: '请选择性别',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }

            if ($("#age").val() == "") {
                api.toast({
                    msg: '请输入年龄',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }

            if ($("#order_number").val() == "") {
                api.toast({
                    msg: '请输入最新一笔拼多多订单号',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }

            if ($("#input_grzl_img").val() == "") {
                api.toast({
                    msg: '请上传个人资料',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }

            if ($("#input_ddjt_img").val() == "") {
                api.toast({
                    msg: '请上传订单截图',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }


            var param = dataFrom("dataForm");
            api.showProgress();
            api.ajax({
                url: myurl + '/index.php/User/Account/postpdd/',
                method: 'post',
                data: {
                    values: param
                }
            }, function(ret, err) {
                api.hideProgress();
                //alert(JSON.stringify(err));
                //alert(JSON.stringify(ret));
                if (ret) {
                    api.toast({
                        msg: ret.msg,
                        duration: 2000,
                        location: 'bottom'
                    });

                    if (ret.status == 1) {
                        var jsfun = 'getAccount()';
                        api.execScript({
                            name: 'window_account',
                            frameName: 'frame_account',
                            script: jsfun
                        });
                        var jsfun_1 = 'getAccount_1()';
                        api.execScript({
                            name: 'window_account',
                            frameName: 'frame_account',
                            script: jsfun_1
                        });
                        var jsfun_2 = 'getList()';
                        api.execScript({
                            name: 'window_account_taobao_info',
                            frameName: 'frame_account_taobao_info',
                            script: jsfun_2
                        });
                        setTimeout(function() {
                            api.closeWin();
                        }, 2000);
                    }

                } else {
                    api.toast({
                        msg: '网络错误',
                        duration: 2000,
                        location: 'bottom'
                    });
                }
            });

        }
        //获取form数据
        function dataFrom(id) {
            var values = {
                "username": $api.getStorage("username"),
                "userid": $api.getStorage("userid")
            };
            var data = $('#' + id).serializeArray();
            $.each(data, function(i, v) {
                var key = v.name,
                    value = v.value;
                if (values[key]) {
                    values[key] = values[key] + ',' + value;
                } else {
                    values[key] = value;
                }
            });
            return values;
        }

        // function openCity() {
        //     var UIActionSelector = api.require('UIActionSelector');
        //     UIActionSelector.open({
        //         datas: 'widget://res/city.json',
        //         layout: {
        //             row: 5,
        //             col: 3,
        //             height: 30,
        //             size: 12,
        //             sizeActive: 14,
        //             rowSpacing: 5,
        //             colSpacing: 10,
        //             maskBg: 'rgba(0,0,0,0.2)',
        //             bg: '#fff',
        //             color: '#888',
        //             colorActive: '#f00',
        //             colorSelected: '#f00'
        //         },
        //         animation: true,
        //         cancel: {
        //             text: '取消',
        //             size: 12,
        //             w: 90,
        //             h: 35,
        //             bg: '#fff',
        //             bgActive: '#ccc',
        //             color: '#888',
        //             colorActive: '#fff'
        //         },
        //         ok: {
        //             text: '确定',
        //             size: 12,
        //             w: 90,
        //             h: 35,
        //             bg: '#fff',
        //             bgActive: '#ccc',
        //             color: '#888',
        //             colorActive: '#fff'
        //         },
        //         title: {
        //             text: '请选择',
        //             size: 12,
        //             h: 44,
        //             bg: '#eee',
        //             color: '#888'
        //         },
        //         fixedOn: api.frameName
        //     }, function(ret, err) {
        //         if (ret) {
        //             var cityValue = '';
        //             if (ret.level1) {
        //                 cityValue += ret.level1;
        //             }
        //             if (ret.level2) {
        //                 cityValue += ' ' + ret.level2;
        //             }
        //             if (ret.level3) {
        //                 cityValue += ' ' + ret.level3;
        //             }
        //             if (cityValue) {
        //                 $api.val($api.byId("city"), cityValue);
        //             }
        //         } else {
        //             api.toast({
        //                 msg: '选择失败',
        //                 duration: 2000,
        //                 location: 'bottom'
        //             });
        //         }
        //     });
        // }

        function getCode() {
            var username = $api.byId("phone").value;
            if (username.length != 11) {
                api.toast({
                    msg: '手机号码位11位',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            if (!new RegExp("^0?(13|15|16|17|18|14|19)[0-9]{9}$").test(username)) {
                api.toast({
                    msg: '请输入手机号码',
                    duration: 2000,
                    location: 'bottom'
                });
                return false;
            }
            leftTime = 60;
            $("#get_code").attr("disabled", true).css("pointer-events", "none");
            var leftSet = setInterval(function() {
                $("#get_code").html('剩余' + leftTime + '秒');
                leftTime--;
                if (leftTime < 1) {
                    clearInterval(leftSet);
                    $("#get_code").removeAttr("disabled");
                    $("#get_code").css("pointer-events", "auto");
                    $("#get_code").text("获取验证码");
                }

            }, 1000);
            api.ajax({
                url: myurl + '/index.php/User/Public/send_phone_code/',
                method: 'post',
                data: {
                    values: {
                        "phone": username,
                    }
                }
            }, function(ret, err) {
                if (ret) {
                    if (ret.status == 1) {
                        api.toast({
                            msg: ret.msg,
                            duration: 2000,
                            location: 'bottom'
                        });
                    } else {
                        api.toast({
                            msg: ret.msg,
                            duration: 2000,
                            location: 'bottom'
                        });
                    }
                } else {
                    api.toast({
                        msg: '网络错误！',
                        duration: 2000,
                        location: 'bottom'
                    });
                }
            });
        }

        function seeEOS(pt_num) {
            api.openWin({
                name: 'window_eos',
                url: './window_eos.html',
                reload: true,
                pageParam: {
                    name: 'window_eos',
                    pt_no: pt_num
                },
                animation: {
                    type: "push",
                    subType: "from_right",
                    duration: 300
                }
            });
        }
    </script>
</body>

</html>
